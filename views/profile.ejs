<!-- views/author.ejs -->
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="/main.css" rel="stylesheet">
    <title>Author Page</title>
</head>
<body>
<div class="flex flex-col min-h-screen bg-amber-50 bg-cover">
    <nav class="flex items-center justify-between p-3 w-full" style="background-color: #041562;">
        <div class="flex items-center space-x-4">
            <img src="/images/logo.png" class="h-14 w-auto" alt="Logo"> 
        </div>
        <div class="flex items-center justify-center space-x-4">
            <a href="/fashion" class="p-4 text-white text-xl">Fashion</a>
            <a href="/electronics" class="p-4 text-white text-xl">Electronics</a>
            <a href="/lifestyle" class="p-4 text-white text-xl">Lifestyle</a>
            <a href="/recreation" class="p-4 text-white text-xl">Recreation</a>
            <a href="/collectibles" class="p-4 text-white text-xl">Collectibles</a>
            <a href="/resources" class="p-4 text-white text-xl">Resources</a>
            <a href="/others" class="pl-4 pr-3 py-4 text-white text-xl">Others</a>
            <a href="/profile" class="py-3"><img src="https://img.icons8.com/?size=100&id=85050&format=png&color=FFFFFF" alt="Profile Icon" class="h-10 w-10"></a>
            <a class="py-3" onclick="changeTextColor('favorites')"><img src="https://img.icons8.com/?size=100&id=85038&format=png&color=FFFFFF" alt="Favorites Icon" class="h-10 w-10"></a>
            <button class="px-4 py-2 mr-5 text-white rounded w-20" onclick="window.location.href='/product'" style="background-color: #DA1212">List</button> 
        </div>
    </nav>

    <div class="flex p-10 w-full">
        <div class="flex items-center justify-end w-1/2 pr-52 py-4">
            <img src="/images/chihiro.jpeg" alt="Profile Picture" class="w-80 h-80 object-cover rounded-full">
        </div>
        <div class="space-y-2 pr-20 py-4">
            <div class="flex edit-container">
                <div class="font-bold text-5xl">
                    <p id="name"><%= user.name %></p>
                </div>
                <div>
                    <img src="https://img.icons8.com/?size=100&id=89802&format=png&color=da1212" alt="Edit Icon" class="mx-4 py-2 w-8 edit-icon" onclick="changeToInput('name')">
                </div>
            </div>
            <p class="text-lg">Rating</p>
            <div class="flex edit-container">
                <div class="font-bold text-2xl">
                    <p id="course"><%= user.school %>, <%= user.course %></p>
                </div>
                <div>
                    <img src="https://img.icons8.com/?size=100&id=89802&format=png&color=da1212" alt="Edit Icon" class="mx-4 w-8 edit-icon" onclick="changeToInput('course')">
                </div>
            </div>
            <a href="/outlook"><img src="https://img.icons8.com/?size=100&id=2848&format=png&color=da1212" alt="Email Icon" class="mt-2 h-10 w-10"></a>
            <div class="flex edit-container">
                <div class="text-2xl">
                    <p id="description">Hi I'm Isabelle, a computer science student with a passion for coding, music, and discovering new places!</p>
                    <!-- <p id="description"><%= user.description %></p> -->
                </div>
                <div>
                    <img src="https://img.icons8.com/?size=100&id=89802&format=png&color=da1212" alt="Edit Icon" class="mx-3 py-2 w-8 edit-icon" onclick="changeToInput('description')">
                </div>
            </div>
        </div>
        <!-- <div id="toggleDiv"><img src="https://img.icons8.com/?size=100&id=43809&format=png&color=da1212" alt="Edit Icon" class="pt-52 w-11"></div> -->
    </div>

    <div class="w-full">
        <div class="flex pl-32 space-x-10 ">
            <p id="listings" class="p-4 cursor-pointer font-bold red underline text-3xl" onclick="changeTextColor('listings')">Listings</p>
            <p id="reviews" class="p-4 cursor-pointer font-bold text-black text-3xl" onclick="changeTextColor('reviews')">Reviews</p>
            <p id="favorites" class="p-4 cursor-pointer font-bold text-black text-3xl" onclick="changeTextColor('favorites')">Favorites</p>
        </div>
        
        <!-- Listings -->
        <div id="listingsContent" class="grid grid-cols-4 gap-2 pl-32 pr-20 pt-4">
            <% listings.forEach((listing, index) => { %>
            <div class="flex flex-cols justify-center py-6" data-transaction-type="<%= listing.transaction_type %>">
                <div class="w-full h-auto">
                    <img src="/images/bracelet.jpg" class="w-80 h-96 object-cover rounded-lg">
                    <p class="pt-3 pb-1 font-bold text-2xl"><%= listing.product_name %></p>
                    <p class="pb-1 text-xl">$<%= listing.price %></p>
                    <div class="flex space-x-1">
                        <div id="first-<%= index %>" class="px-4 py-1 rounded-full text-white" style="background-color: #DA1212;">
                            <!-- <p>Free</p> -->
                        </div>
                        <div id="second-<%= index %>" class="px-4 py-1 rounded-full text-white hidden" style="background-color: #DA1212;">
                            <!-- <p>Trade</p> -->
                        </div>
                    </div>
                </div>
            </div>
            <% }) %>
       </div>

       <!-- Reviews -->
       <div id="reviewsContent" class="flex flex-col justify-center px-36 hidden">
        <% for (let i = 0; i < 6; i++) { %>
            <div class="flex pl-12 pr-10 py-8 my-2 rounded-xl" style="background-color: #D9D9D9;">
                <div>
                    <img src="/images/chihiro.jpeg" alt="Profile Picture" class="w-24 h-20 object-cover rounded-full">
                </div>
                <div class="flex flex-col px-7">
                    <p class="font-bold text-xl">Tyler</p>
                    <p>Rating</p>
                    <p class="text-lg">Great transaction! Met up at school as agreed, and the item was exactly as described. The seller was punctual and friendly. Would definitely deal with them again. Thanks!</p>
                </div>
            </div>
        <% } %>
       </div>

        <!-- Favorites -->
        <div id="favoritesContent" class="grid grid-cols-4 gap-2 pl-32 pr-20 pt-4 hidden">
            <% for (let i = 0; i < 8; i++) { %>
            <div class="flex flex-cols justify-center py-6">
                <div class="w-full h-auto">
                    <img src="/images/bracelet.jpg" class="w-80 h-96 object-cover rounded-lg">
                    <p class="pt-3 pb-1 font-bold text-2xl">Bracelet</p>
                    <p class="pb-1 text-xl">$120</p>
                    <div class="flex space-x-1">
                        <div id="first" class="px-4 py-1 rounded-full text-white" style="background-color: #DA1212;">
                            <p>Free</p>
                        </div>
                        <div id="second" class="px-4 py-1 rounded-full text-white hidden" style="background-color: #DA1212;">
                            <p>Trade</p>
                        </div>
                    </div>
                </div>
            </div>
            <% } %>
       </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    function deleteArticle(id) {
        fetch(`/author/delete-article/${id}`, { method: 'DELETE' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    window.location.reload();
                } else {
                    alert('Error deleting article');
                }
            });
    }

    function publishArticle(id) {
        fetch(`/author/publish-article/${id}`, { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    window.location.reload();
                } else {
                    alert('Error publishing article');
                }
            });
    }

    $(".logoutBtn").click(function () {
        alert("Logged Out");
    });

    function changeTextColor(id) {
        const elements = document.querySelectorAll('.cursor-pointer');
        elements.forEach(el => {
            el.classList.remove('red');
            el.classList.remove('underline');
            el.classList.add('text-black');
        });
        document.getElementById(id).classList.remove('text-black');
        document.getElementById(id).classList.add('red');
        document.getElementById(id).classList.add('underline');

        if(id == "listings") {
            document.getElementById("listingsContent").classList.remove('hidden');
            document.getElementById("reviewsContent").classList.add('hidden');
            document.getElementById("favoritesContent").classList.add('hidden');
        } else if(id == "reviews") {
            document.getElementById("reviewsContent").classList.remove('hidden');
            document.getElementById("listingsContent").classList.add('hidden');
            document.getElementById("favoritesContent").classList.add('hidden');
        } else if (id == "favorites") {
            document.getElementById("favoritesContent").classList.remove('hidden');
            document.getElementById("reviewsContent").classList.add('hidden');
            document.getElementById("listingsContent").classList.add('hidden');
        }
    }

    function changeToInput(id) {
        if(id == "name") {
            const editIcons = document.querySelectorAll('.edit-icon');
            editIcons[0].classList.add('hidden');
            var name = document.getElementById("name");
            var text = name.innerText;
            var input = document.createElement("input");
            input.className = id.className; // Preserve the same styling
            input.value = text;
            input.onblur = function() { // Change back to <p> on blur
                changeToParagraph(input, id);
            };

            name.replaceWith(input);
            input.focus();
        } else if(id == "description") {
            const editIcons = document.querySelectorAll('.edit-icon');
            editIcons[2].classList.add('hidden');
            var desc = document.getElementById("description");
            var text = desc.innerText;
            var textarea = document.createElement("textArea");
            textarea.className = id.className; // Preserve the same styling
            textarea.value = text;
            textarea.rows = 5;// Set the number of rows
            textarea.cols = 66; // Set the number of columns
            textarea.onblur = function() { // Change back to <p> on blur
                changeToParagraph(textarea, id);
            };

            desc.replaceWith(textarea);
            textarea.focus();
        }
    }

    function changeToParagraph(input, id) {
        const editIcons = document.querySelectorAll('.edit-icon');
        editIcons.forEach(icon => icon.classList.remove('hidden'));
        var text = input.value;
        var pElement = document.createElement("p");
        pElement.id = id;
        pElement.className = input.className; // Preserve the same styling
        pElement.innerText = text;
        input.replaceWith(pElement);
    }

    document.addEventListener('DOMContentLoaded', switchText);

    function switchText() {
        const listingsContent = document.getElementById('listingsContent');
        const listingsItems = listingsContent.querySelectorAll('.flex-cols');

        listingsItems.forEach((item, index) => {
            const transactionType = item.dataset.transactionType;
            const firstBubble = document.getElementById(`first-${index}`);
            const secondBubble = document.getElementById(`second-${index}`);
            
            if (firstBubble) {
                if (transactionType === "Free") {
                    firstBubble.innerHTML = '<p>Free</p>';
                } else if (transactionType === "Sell") {
                    firstBubble.innerHTML = '<p>Sell</p>';
                } else if (transactionType === "Trade") {
                    firstBubble.innerHTML = '<p>Trade</p>';
                }
            }
            
            if (secondBubble) {
                secondBubble.innerHTML = '<p>Exchange</p>';
            }
        });
    }

</script>
</body>
</html>